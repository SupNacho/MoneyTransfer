# MoneyTransfer

## Архитектура:</br>
В качестве архитектурного паттерна я использовал MVP.

##Хранение коллекции введенных карт:</br>
Для хранения введенных карт я решил не использовать ORM и базы данных, так как объем данных не такой большой. 
Коллекции карт преобразую в `JSON` с помощью библиотеки `GSON` и сохраняю в `SharedPrefences`, в качестве ключа используется токен пользователя.
По грубым подсчетам предельное количество хранимых уникальных карт в `SharedPrefences` составляет около 15000.
При получении данных из файла, я так же с помощью  библиотеки `GSON` преобразую полученный `JSON` в объект коллекции карт.

##Проверка данных вводимых пользователем</br>
###Проверка номера карт: </br>
Номер карты сначала проверяется на количество введенных цифр. После того, как пользователь введет 13 цифр 
(минимальное количество цифр в номерах существующих картах), номер карты начинает проверяется по алгоритму Луна.
Пока номер карты не пройдет проверки выводятся соответствующие уведомления у поля ввода.

###Проверка актуальности даты:</br>
Пользователь вводит дату в формате `MM/YY`, проверка осуществляется путем сравнения дат `>=`.
Пока дата не проходит проверки выводятся соответствующие уведомления у поля ввода.

###Проверка CVV2
По заданию проверка должна была выводить ошибку, если cvv2 код больше 3-х цифр. Я несколько модифицировал эту проверку, т.к. не нашел информации, что проверочный код может быть меньше 3-х цифр. Я проверяю, что введенные символы - цифры, проверяю количество введенных символов. Если количество символов != 3 , то вывожу сообщение об ошибке. Также в layout`е я ограничил количество вводимых знаков 3-мя, поэтому ситуация когда будут введены 4 знака маловероятна.
Пока CVV2 не проходит проверки выводятся соответствующие уведомления у поля ввода.

###Проверка вводимой суммы
Сумму проверяем по следующим критериям: что это число, что оно больше нуля и что количество знаков после запятой не более 2-х. С помощью `InputFilter` ограничиваю количество вводимых цифр после запятой. Также в `TextWatcher` отслеживаю попытки пользователя ввести сумму в формате `0876` и преобразовываю ее в `876`.
Пока сумма не проходит проверки выводятся соответствующие уведомления у поля ввода.

###Перевод суммы
При нажатии на кнопку перевода все поля еще раз проверяются на верность введенных данных. Если имеются ошибки - выводится сообщение об  этом. Если ошибок нет, то совершается "перевод" и добавляются карты в коллекцию.

###Добавление карт в коллекции:</br>
Если ошибок нет и перевод суммы может быть осуществлен, то мы проверяем карты на наличие или отсутствие флага `isNewCard`. Если флаг есть, то карта добавляется в коллекцию. Объект коллекции карт сам контролирует уникальность хранимых карт, и, если такой карты нет в коллекции, то она добавляется. В противном случае команда на добавление игнорируется. Если в коллекцию была добавлена новая карта, то происходит сохранение коллекции в постоянной защищенной области памяти. Если же в коллекцию ничего добавлено не было, то сохранения также не происходит. 
